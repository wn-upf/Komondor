<p align="center"> 
<img src="https://github.com/wn-upf/Komondor/blob/master/Documentation/Other/Images and resources/komondor_logo.png">
</p>

# Komondor: An IEEE 802.11ax Simulator
| Agent-related content available [here](https://github.com/wn-upf/Komondor/blob/master/README_agents.md). |
| ----- |

## Table of Contents
- [Authors](#authors)
- [Introduction](#introduction)
- [Overview](#overview)
- [Installation](#installation)
- [Usage](#usage)
- [Validation](#validation)
- [Contribute](#contribute)
- [Acknowledgements](#acknowledgements)

## Authors
* [Sergio Barrachina-Muñoz](https://github.com/sergiobarra)
* [Francesc Wilhelmi](https://github.com/fwilhelmi)

Both authors have the same contribution to this project.

## Introduction

Komondor is a wireless network simulator that includes novel mechanisms for next-generation WLANs, such as dynamic channel bonding or enhanced spatial reuse. One of the main purposes of Komondor is to simulate the behavior of IEEE 802.11ax-2019 networks, an amendment designed to boost spectral efficiency in dense deployments.
		
Komondor has been conceived as an open source tool that contributes to the ongoing research in wireless networks, especially regarding the implementation of novel functionalities that are not available in other well-known wireless simulators. In addition, it has been prepared for a simple integration with Machine Learning (ML) modules.

The project is structured as follows:
* ```Apps```: contains auxiliary applications that support the Komondor's core operation. For example, in /Apps we find the "Input Generation" project, which contains a Java application that generates inputs for Komondor in an easy and flexible way.
* ```Code```: contains the core files to compile and run Komondor, including input and output folders. 
* ```Documentation```: contains Documentation related to Komondor, such as a Manual, a user's guide, presentations, etc.

Doxygen documentation available [here](http://htmlpreview.github.io/?https://github.com/wn-upf/Komondor/blob/master/Documentation/doxy/html/index.html).

## Overview

The code to run simulations is organized as follows:

* ```COST```: constitutes the Komondor's primitive operation. Here we find the CompC++ library that allows generating discrete event simulations. For further information about COST, please refer to its main [website](http://www.ita.cs.rpi.edu/cost.html). 
* ```main```: contains the core files (komondor.cc, node.h, traffic_generator.h, agent.h, and central_controller.h) that are in charge of orchestrating all the simulation. "komondor.cc" is the main component, which initializes all the other components of "Type II". All these modules are aware of the existence of the simulation time. In addition to the core components, here we find "build_local", a bash script that compiles the libraries for executing the code. Note that the file "compcxx_komondor_main.h" is also required to carry out such a compilation.
* ```methods```: by following clean architecture guidelines, independent methods used by core files are contained in the methods folder. Several libraries are provided according to the nature of their functions. For instance, "backoff_methods.h" contains methods to handle the backoff operation in the Distributed Coordination Function (DCF).
* ```structures```: the Komondor simulator considers several header files to carry out its operation. Among them, we find "wlan.h", which defines the main characteristics of a WLAN (WLAN id, list of associated STAs, etc.). In addition, the "notification.h" structure allows us to define the information to be exchanged between devices. 
* ```learning_modules```: here we find the implementation of ML methods that receive feedback about the network's performance in simulation time. 
* ```list_of_macros.h```: all the static parameters (e.g., constants) are contained in this file.
* ```input```: contains the input files that allow building the simulation environment.
* ```output```: contains the data generated by Komondor as a result of a given simulation.	
* ```scripts_multiple_executions```: contains bash scripts to perform multiple simulations.

An overview of the current modules available in Komondor is shown next:
<p align="center"> 
<img src="https://github.com/wn-upf/Komondor/blob/master/Documentation/Other/Images and resources/modules_overview.png">
</p>

## Installation

### Prerequisites

Komondor requires the following system dependencies:

- **C++ Compiler**: GCC (g++) 4.8 or later, or Clang
- **Build Tools**: `make` (GNU Make)
- **Lexical Analyzer**: `flex` (Fast Lexical Analyzer)
- **Operating System**: Linux, macOS, or Unix-like system

#### Installing Dependencies

**Ubuntu/Debian:**
```bash
sudo apt-get update
sudo apt-get install build-essential flex g++ make
```

**Fedora/RHEL/CentOS:**
```bash
sudo dnf install gcc-c++ make flex
```

**macOS (using Homebrew):**
```bash
brew install flex
```

### Automated Installation (Recommended)

The easiest way to build Komondor is using the automated build script, which handles architecture detection, CompC++ compilation, and Komondor building automatically:

```bash
cd Code
./build.sh
```

This script will:
1. Check if the CompC++ compiler binary exists and matches your platform architecture
2. Automatically rebuild CompC++ if needed (handles cross-platform compatibility)
3. Verify all required dependencies are installed
4. Build the Komondor simulator
5. Provide clear error messages and guidance if any step fails

**Note:** The build script automatically detects architecture mismatches (e.g., macOS binaries on Linux systems) and rebuilds the necessary components for your platform.

### Manual Installation

If you prefer to build manually or need more control over the build process:

#### Step 1: Build CompC++ Compiler

The CompC++ compiler is required to generate C++ code from Komondor's component-based source files.

```bash
cd Code/compcpp
make clean
make
cp cxx ../COST/cxx
```

#### Step 2: Build Komondor

```bash
cd Code/main
./build_local
```

Alternatively, use the Makefile:

```bash
cd Code/main
make
```

### Verification

After successful installation, verify the build:

```bash
cd Code/main
ls -lh komondor_main
./komondor_main --help  # If help is available
```

The Komondor executable should be located at `Code/main/komondor_main`.

### Troubleshooting

#### Architecture Mismatch Errors

If you encounter errors like:
```
cannot execute binary file: Exec format error
```

This indicates that the CompC++ binary was compiled for a different architecture. The automated build script (`./build.sh`) will automatically detect and fix this issue. If building manually, rebuild CompC++ from source (see Manual Installation, Step 1).

#### Missing Dependencies

If the build fails due to missing dependencies, install them using your system's package manager (see Prerequisites section above).

#### Clean Build

To perform a clean rebuild from scratch:

```bash
# Clean CompC++ build
cd Code/compcpp
make clean

# Clean Komondor build
cd ../main
make clean  # Removes komondor_main and komondor_main.cxx

# Rebuild
cd ..
./build.sh
```

### Additional Resources

- Detailed installation and execution instructions: [Komondor User's Guide](https://github.com/wn-upf/Komondor/blob/master/Documentation/User%20guide/LaTeX%20files/komondor_user_guide.pdf)
- Build documentation: See `Code/BUILD_README.md` for detailed build instructions
- Doxygen documentation: Available [here](http://htmlpreview.github.io/?https://github.com/wn-upf/Komondor/blob/master/Documentation/doxy/html/index.html)

## Usage

### Basic Simulation

Run Komondor with the following command:
```bash
cd Code/main
./komondor_main INPUT_FILE_NODES OUTPUT_FILE_LOGS FLAG_SAVE_NODE_LOGS FLAG_PRINT_SYSTEM_LOGS FLAG_PRINT_NODE_LOGS SIM_TIME SEED
```

**Parameters:**
- `INPUT_FILE_NODES`: CSV file containing node information (position, channels, etc.). Must use semicolons as separators.
- `OUTPUT_FILE_LOGS`: Path to the output file for simulation results (created if it doesn't exist).
- `FLAG_SAVE_NODE_LOGS`: Save node logs to separate files (1) or not (0). **Note:** Enabling this flag increases execution time.
- `FLAG_PRINT_SYSTEM_LOGS`: Print system logs to console (1) or not (0).
- `FLAG_PRINT_NODE_LOGS`: Print node logs to console (1) or not (0).
- `SIM_TIME`: Simulation time duration.
- `SEED`: Random seed for simulation reproducibility.

### Simulation with Intelligent Agents

To run Komondor with ML-based intelligent agents:

```bash
./komondor_main INPUT_FILE_NODES INPUT_FILE_AGENTS OUTPUT_FILE_LOGS FLAG_SAVE_NODE_LOGS FLAG_SAVE_AGENT_LOGS FLAG_PRINT_SYSTEM_LOGS FLAG_PRINT_NODE_LOGS FLAG_PRINT_AGENT_LOGS SIM_TIME SEED
```

**Additional Parameters:**
- `INPUT_FILE_AGENTS`: CSV file containing agent configuration parameters.
- `FLAG_SAVE_AGENT_LOGS`: Save agent logs to separate files (1) or not (0).
- `FLAG_PRINT_AGENT_LOGS`: Print agent logs to console (1) or not (0).

For detailed information about agents, see [README_agents](https://github.com/wn-upf/Komondor/blob/master/README_agents.md).

### Input Files

Input files are located in the `Code/input` directory:

- **`input_nodes_conf.csv`**: Defines node parameters (ID, location, channels, etc.)
- **`agents.csv`**: Defines agent configuration parameters (required for agent-based simulations)

Additional configuration models are loaded from the `config_models` directory. See the [Komondor User's Guide](https://github.com/wn-upf/Komondor/blob/master/Documentation/User%20guide/LaTeX%20files/komondor_user_guide.pdf) for detailed input file specifications.

### Output Files

Simulation results are written to the `Code/output` directory, including:
- System logs and statistics
- Node-specific logs (if `FLAG_SAVE_NODE_LOGS` is enabled)
- Agent logs (if agents are used and `FLAG_SAVE_AGENT_LOGS` is enabled)

### Debugging Tools (Optional)

For debugging and profiling:

**Ubuntu/Debian:**
```bash
sudo apt-get install gdb valgrind
```

**Fedora/RHEL/CentOS:**
```bash
sudo dnf install gdb valgrind
```

## Validation
Komondor v.2.0 has been validated by means of ns-3 and SF-CTMN, and Bianchi analytical models. The presentation of the validation can be found at "S. Barrachina-Muñoz, F. Wilhelmi, I. Selinis & B. Bellalta. Komondor: a Wireless Network Simulator for Next-Generation High-Density WLANs. 2018". Additional resources are available in this repository, in the folder /Documentation/Validation. Files used for each simulation tool can be found:
1) ns-3: execution script and instructions, together with the simulation environment used for validation.
2) Komondor: input "nodes" and "system" files. Release pointing to v.2.0 must be used.
3) SF-CTMN: simulation environment, to be executed through the SF-CTMN framework, available at https://github.com/sergiobarra/SFCTMN
4) Bianchi: Matlab files emulating the Bianchi model ("Bianchi, G., Fratta, L., & Oliveri, M. (1996, October). Performance evaluation and enhancement of the CSMA/CA MAC protocol for 802.11 wireless LANs. In Personal, Indoor and Mobile Radio Communications, 1996. PIMRC'96., Seventh IEEE International Symposium on (Vol. 2, pp. 392-396). IEEE.") can be found, which simulate the throughput achieved by each WLAN in each of the proposed scenarios.

### Regression test
An automated regression test is available to ensure that the development of new features does not affect the previous implementation, which was validated in Barrachina-Muñoz, S., Wilhelmi, F., Selinis, I., & Bellalta, B. (2019, April). Komondor: a Wireless Network Simulator for Next-Generation High-Density WLANs. In 2019 Wireless Days (WD) (pp. 1-8). IEEE.

In order to execute the regression test, go to ./Komondor/Code/input and run the script named "script_regression_validation_scenarios.sh". This script will take the inputs from the "validation" folder, execute the corresponding simulations, and compare the output with the expected results (i.e., the results obtained for the aforementioned paper).

The output of the regression test will be displayed in the console. In case of success, the following output should be observed:
<p align="center"> 
<img src="https://github.com/wn-upf/Komondor/blob/master/Documentation/Other/Images and resources/example_execution_regression_test.png">
</p>

Before executing the regression test, it is important to ensure that "simulation_ix_output_script" in config_models is set to 10 and "path_loss_model" to 4.

## Academic/Education projects
One of the main purposes of Komondor is to serve as an academic/educational tool. In what follows, we list the projects in which Komondor has been used as a simulation tool:
* Wilhelmi, F., Bellalta, B., Szott, S., Kosek-Szott, K., & Barrachina-Muñoz, S. (2025, May). Coordinated Multi-Armed Bandits for Improved Spatial Reuse in Wi-Fi. In 2025 IEEE International Conference on Machine Learning for Communication and Networking (ICMLCN) (pp. 1-6). IEEE. [(Download the paper here)](https://arxiv.org/abs/2412.03076)
* Wilhelmi, F., Galati-Giordano, L., & F., G. (2025, March). “It's Your Turn”: A Novel Channel Contention Mechanism for Improving Wi-Fi's Reliability. In 2025 IEEE Wireless Communications and Networking Conference (WCNC) (pp. 1-6). IEEE. [(Download the paper here)](https://arxiv.org/abs/2410.07874)
* Wilhelmi, F., Szott, S., Kosek-Szott, K., & Bellalta, B. (2024). Machine Learning and Wi-Fi: Unveiling the Path Toward AI/ML-Native IEEE 802.11 Networks. IEEE Communications Magazine. [(Download the paper here)]([https://arxiv.org/abs/2412.03076](https://arxiv.org/abs/2405.11504)
* Wilhelmi, F. & Bellalta, B. (2020). ITU AI for 5G Challenge. [UPF/ITU-T AI Challenge - Improving the capacity of IEEE 802.11 WLANs through Machine Learning](https://www.upf.edu/web/wnrg/ai_challenge).
* Wilhelmi, F., Carrascosa, M., Cano, C., Jonsson, A., Ram, V., & Bellalta, B. (2021). Usage of Network Simulators in Machine-Learning-Assisted 5G/6G Networks. [IEEE Wireless Communications Magazine](https://ieeexplore.ieee.org/abstract/document/9363049).
* Wilhelmi, F., Barrachina-Muñoz, S., Bellalta, B., Cano, C., Jonsson, A., & Ram, V. (2020). A flexible machine-learning-aware architecture for future WLANs. [IEEE Communications Magazine, 58(3), 25-31](https://ieeexplore.ieee.org/abstract/document/9040258/).
* Wilhelmi, Francesc, Sergio Barrachina-Muñoz, and Boris Bellalta. "Spatial Reuse in IEEE 802.11ax WLANs." [Computer Communications](https://www.sciencedirect.com/science/article/abs/pii/S0140366421000499) (2020). 
* Barrachina-Muñoz, Sergio, et al. "Online Primary Channel Selection for Dynamic Channel Bonding in High-Density WLANs." [IEEE Wireless Communications Letters (2019)](https://ieeexplore.ieee.org/abstract/document/8894073/). 
* Barrachina-Muñoz, Sergio, et al. "Komondor: a wireless network simulator for next-generation high-density WLANs." [Wireless Days (WD), 1-8 (2019)](https://ieeexplore.ieee.org/abstract/document/8734225). 
* Barrachina-Muñoz, Sergio, et al. "Dynamic Channel Bonding in Spatially Distributed High-Density WLANs." [IEEE Transactions on Mobile Computing (2019)](https://ieeexplore.ieee.org/abstract/document/8642923). 
* SECTOR, STANDARDIZATION. FOCUS GROUP ON MACHINE LEARNING FOR FUTURE NETWORKS INCLUDING 5G ML5G-I-125-R3. [StandICT](https://www.standict.eu/sites/default/files/ML5G-I-125-R3.pdf).
* Wilhelmi, Francesc, et al. "Potential and pitfalls of multi-armed bandits for decentralized spatial reuse in WLANs." [Journal of Network and Computer Applications 127 (2019)](https://www.sciencedirect.com/science/article/pii/S1084804518303655): 26-42. 
* Barrachina-Muñoz, Sergio, et al. "To overlap or not to overlap: Enabling channel bonding in high-density WLANs." [Computer Networks 152 (2019)](https://www.sciencedirect.com/science/article/pii/S1389128618309745). 
* Wilhelmi, F., Barrachina-Muñoz, S., & Bellalta, B. (2019, October). On the Performance of the Spatial Reuse Operation in IEEE 802.11 ax WLANs. In 2019 IEEE Conference on Standards for Communications and Networking (CSCN) (pp. 1-6). IEEE. [IEEE Conference on Standards for Communications and Networking (CSCN)](https://ieeexplore.ieee.org/abstract/document/8931315/).

## Contribute

If you want to contribute, please contact [francisco.wilhelmi@upf.edu](francisco.wilhelmi@upf.edu)

More details in [CONTRIBUTING.md](https://github.com/wn-upf/Komondor/blob/master/CONTRIBUTING.md)

## Acknowledgements

2025-2027: This work is supported by the CHIST-ERA Wireless AI 2022 call MLDR project (ANR-23-CHR4-0005), partially funded by AEI under project PCI2023-145958-2, by Wi-XR PID2021-123995NB-I00 and TRUE-Wi-Fi PID2024-155470NB-I00 (MCIU/AEI/FEDER,UE), and by MCIN/AEI under the Maria de Maeztu Units of Excellence Programme (CEX2021-001195-M).
2019-2020: This work has been partially supported by a Gift from the Cisco University Research Program (CG\#890107, Towards Deterministic Channel Access in High-Density WLANs) Fund, a corporate advised fund of Silicon Valley Community Foundation.
